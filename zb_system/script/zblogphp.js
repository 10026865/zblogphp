/** 
 * Z-BlogPHP JavaScript Framework
 * @author zsx<zsx@zsxsoft.com>
 */
(function(){var g=function(a,b){if("undefined"==typeof jQuery&&"undefined"==typeof b)throw Error("No jQuery!");this.$=b||jQuery;h(this);a=a||{};a.cookiepath=a.cookiepath||"/";a.bloghost=a.bloghost||location.origin;a.ajaxurl=a.ajaxurl||location.origin;a.commentmaxlength=a.commentmaxlength||1E3;a.lang=a.lang||{};this.options=a;this.userinfo.username=this.cookie.get("name");this.userinfo.mail=this.cookie.get("email");this.userinfo.homepage=this.cookie.get("homepage");this.plugin.on("userinfo.output",
"system",function(){this.$("#inpName").val(this.userinfo.username);this.$("#inpEmail").val(this.userinfo.mail);this.$("#inpHomePage").val(this.userinfo.homepage)});this.plugin.on("userinfo.savefromhtml","system",function(){this.userinfo.username=this.$("#inpName").val();this.userinfo.mail=this.$("#inpEmail").val();this.userinfo.homepage=this.$("#inpHomePage").val();this.userinfo.save()});this.plugin.on("userinfo.save","system",function(){this.cookie.set("name",this.userinfo.username);this.cookie.set("email",
this.userinfo.mail);this.cookie.set("homepage",this.userinfo.homepage)});this.plugin.on("comment.verifydata","system",function(c,a){var b={name:[!1,72,/^[\.\_A-Za-z0-9\u4e00-\u9fa5]+$/ig],email:[!0,29,/^[\w-]+(\.[\w-]+)*@[\w-]+(\.[\w-]+)+$/ig],content:[!1,46,/./]},d;for(d in b){var e=b[d];if(!e[0]&&""===a[d]||!e[2].test(a[d])&&""!==a[d])return c.no=e[1],c.msg=this.options.lang.error[c.no],c}b=$("#inpId").parent("form").find(":submit");b.data("orig",b.val()).val("Waiting...").attr("disabled","disabled").addClass("loading")});
this.plugin.on("comment.posterror","system",function(c,a){var b=$("#inpId").parent("form").find(":submit");b.removeClass("loading").removeAttr("disabled").val(b.data("orig"))});this.plugin.on("comment.postsuccess","system",function(c,a,b,d){var e=$("#inpId").parent("form").find(":submit");e.removeClass("loading").removeAttr("disabled").val(e.data("orig"));if(0<a.search("faultCode")&&0<a.search("faultString")){e=s.match("<string>.+?</string>")[0].replace("<string>","").replace("</string>","");alert(e);
try{console.log(arguments),console.log("ERROR - "+e)}catch(g){}}else e=a.match(/cmt\d+/),0===c.replyid?this.$(a).insertAfter("#AjaxCommentBegin"):this.$(a).insertAfter("#AjaxComment"+c.replyid),location.hash="#"+e,this.$("#txaArticle").val(""),this.userinfo.saveFromHtml()});this.plugin.on("comment.get","system",function(c,a){this.$.get(this.options.bloghost+"zb_system/cmd.php?act=getcmt&postid="+c+"&page="+a,function(b,d,e){this.plugin.emit("comment.got",[c,a],b,d,e)})});this.plugin.on("comment.got",
"system",function(c,a,b,d){this.$("#AjaxCommentBegin").nextUntil("#AjaxCommentEnd").remove();this.$("#AjaxCommentBegin").after(a)});this.plugin.on("comment.reply","system",function(a){var b=this;this.$("#inpRevID").val(a);this.$("#cancel-reply").show().bind("click",function(){b.$("#inpRevID").val(0);b.$(this).hide();window.location.hash="#comment";return!1});window.location.hash="#comment"});return this};g.prototype._plugins={};var h=function(a){var b=function(){};b.prototype.bind=b.prototype.on=
b.prototype.addListener=function(c,b,f){"undefined"==typeof a._plugins[c]&&(a._plugins[c]={});a._plugins[c][b]=f;return a};b.prototype.unbind=b.prototype.removeListener=function(c,b){b||(b="");""===b?a._plugins[c]={}:(a._plugins[c][b]=null,delete a._plugins[c][b]);return a};b.prototype.emit=function(c){for(var b=[],f=1;f<arguments.length;f++)b.push(arguments[f]);for(var d in a._plugins[c])a._plugins[c][d].apply(a,b);return a};a.plugin=new b;b=function(){};b.prototype.get=function(a){return(a=document.cookie.match(new RegExp("(^| )"+
a+"=([^;]*)(;|$)")))?unescape(a[2]):null};b.prototype.set=function(c,b,f){var d=new Date;f&&d.setTime(d.getTime()+parseInt(864E5*f));document.cookie=c+"="+escape(b)+"; "+(f?"expires="+d.toGMTString()+"; ":"")+"path="+a.options.cookiepath;return a};a.cookie=new b;b=function(){};b.prototype.output=function(){a.plugin.emit("userinfo.output");return a};b.prototype.save=function(){a.plugin.emit("userinfo.save");return a};b.prototype.saveFromHtml=function(){a.plugin.emit("userinfo.savefromhtml");return a};
a.userinfo=new b;b=function(){};b.prototype.get=function(c,b){a.plugin.emit("comment.get",c,b);return a};b.prototype.reply=function(c){a.plugin.emit("comment.reply",c);return a};b.prototype.post=function(c){c=c||{};c.action=c.action||$("#inpId").parent("form").attr("action");c.postid=c.postid||$("#inpId").val();c.verify=c.verify||$("#inpVerify").val();c.name=c.name||$("#inpName").val();c.email=c.email||$("#inpEmail").val();c.content=c.content||$("#txaArticle").val();c.homepage=c.homepage||$("#inpHomePage").val();
c.replyid=c.replyid||$("#inpRevID").val();c.isajax=c.isajax||!0;var b={no:0,msg:""};a.plugin.emit("comment.verifydata",b,c);if(0!==b.no){alert(b.msg);try{console.log(c),console.log("ERROR - "+b.msg)}catch(f){}a.plugin.emit("comment.posterror",b,c);return!1}a.$.post(c.action,c,function(b,e,f){a.plugin.emit("comment.postsuccess",c,b,e,f)});return a};a.comment=new b};"function"===typeof define&&define.amd?define("zbp",[],function(){return g}):"function"===typeof define&&define.cmd?define("zbp",[],function(require, exports, module){module.exports=g}):window.ZBP=g})();
