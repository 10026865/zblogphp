(function(){var h=["comment.verifydata"],f={"comment.reply":"comment.reply.start","comment.postsuccess":"comment.post.success","userinfo.savefromhtml":"userinfo.readFromHtml","comment.posterror":"comment.post.error"},g=function(b,e){if("undefined"==typeof jQuery&&"undefined"==typeof e)throw Error("No jQuery!");this.$=e||jQuery;Object.keys||(Object.keys=function(a){return $.map(a,function(c,a){return a})});console||(window.console={},console.logs=[],console.log=console.error=console.warning=function(){console.logs.push(arguments)});
h=h.concat(Object.keys(f));var a=this;k(this);b=b||{};b.cookiepath=b.cookiepath||"/";b.bloghost=b.bloghost||location.origin;b.ajaxurl=b.ajaxurl||location.origin;b.commentmaxlength=b.commentmaxlength||1E3;b.lang=b.lang||{};this.eachOnCommentInputs=function(a){return this.$.each(b.comment.inputs,a)};this.eachOnCommentInputs(function(d,c){!c.getter&&c.selector&&(c.getter=function(){return $(c.selector).val()});!c.setter&&c.selector&&(c.setter=function(a){return $(c.selector).val(a)});c.validator||(c.validator=
function(d,b){for(d=d||c.getter();!(c.required&&""===d.trim()||c.validateRule&&(c.validateRule.lastIndex=0,!c.validateRule.test(d)));)return b(null);return b({code:c.validateFailedErrorCode,message:c.validateFailedMessage||a.options.lang.error[c.validateFailedErrorCode]})})});this.options=b;this.plugin.on("userinfo.output","system",function(){a.eachOnCommentInputs(function(d,c){c.saveLocally&&c.setter(a.userinfo[d])})});this.plugin.on("userinfo.savefromhtml","system",function(){a.eachOnCommentInputs(function(d,
c){c.saveLocally&&(a.userinfo[d]=c.getter())});a.userinfo.save()});this.plugin.on("userinfo.save","system",function(){a.eachOnCommentInputs(function(d,c){c.saveLocally&&(a.userinfo[d]=c.getter(),a.cookie.set("zbp_userinfo_"+d,a.userinfo[d]))})});this.plugin.on("comment.get","system",function(d,c){a.$.get(a.options.bloghost+"zb_system/cmd.php?act=getcmt&postid="+d+"&page="+c,function(b,e,l){a.plugin.emit("comment.got",[d,c],b,e,l)})});this.plugin.on("comment.post.validate","system",function(d){var c=
0,b=!1,e=function(e){b||(e?(b=!0,a.plugin.emit("comment.post.validate.error",e,d)):(c++,c===Object.keys(a.options.comment.inputs).length&&(e={no:0,msg:""},a.plugin.emit("comment.verifydata",e,d),0<e.no?a.plugin.emit("comment.post.validate.error",{number:err.no,message:err.msg},d):a.plugin.emit("comment.post.validate.done",d))))};a.eachOnCommentInputs(function(a,c){c.validator(d[a],e)})});this.plugin.on("comment.post.start","system",function(d){a.eachOnCommentInputs(function(a,b){d[a]=d[a]||b.getter()});
d.commentKey=(new Date).getTime()+""+Math.random();a.plugin.emit("comment.post.validate",d)});this.plugin.on("comment.post.validate.error","system",function(d,c){alert(d.message);console.error(c);console.error("ERROR - "+d.message);a.plugin.emit("comment.post.error",d,c)});this.plugin.on("comment.post.validate.done","system",function(d){a.$.post(d.action,d).done(function(c,b,e){a.plugin.emit("comment.post.success",d,c,b,e)}).fail(function(c,b){a.plugin.emit("comment.post.error",{jqXHR:c,message:b,
code:255},d)})});this.options.comment.useDefaultEvents&&(this.plugin.on("comment.reply.start","system-default",function(a){var c=this;this.$("#inpRevID").val(a);this.$("#cancel-reply").show().bind("click",function(){c.$("#inpRevID").val(0);c.$(this).hide();window.location.hash="#comment";return!1});window.location.hash="#comment"}),this.plugin.on("comment.got","system-default",function(a,c,b,e){this.$("#AjaxCommentBegin").nextUntil("#AjaxCommentEnd").remove();this.$("#AjaxCommentBegin").after(c)}),
this.plugin.on("comment.post.start","system-default",function(){var a=$("#inpId").parent("form").find(":submit");a.data("orig",a.val()).val("Waiting...").attr("disabled","disabled").addClass("loading")}),this.plugin.on("comment.post.error","system-default",function(a,c){var b=$("#inpId").parent("form").find(":submit");b.removeClass("loading").removeAttr("disabled");b.data("orig")&&b.val(b.data("orig"))}),this.plugin.on("comment.post.success","system-default",function(a,c,b,e){b=$("#inpId").parent("form").find(":submit");
b.removeClass("loading").removeAttr("disabled").val(b.data("orig"));c=$.parseJSON(c);if(0!==c.err.code)throw alert(c.err.msg),"ERROR - "+c.err.msg;"0"==a.replyid?this.$(c.data.html).insertAfter("#AjaxCommentBegin"):this.$(c.data.html).insertAfter("#AjaxComment"+a.replyid);location.hash="#cmt"+c.data.ID;this.$("#txaArticle").val("");this.userinfo.readFromHtml()}));return this};g.prototype._plugins={};var k=function(b){b.utils={};b.utils.getFromIndex=function(a,b){for(var c=[],d=a;d<b.length;d++)c.push(b[d]);
return c};var e=function(){};e.prototype.checkIsInterfaceDeprecated=function(a){return 0<=h.indexOf(a)?(console.error("Interface '"+a+"' is deprecated, please update your plugin or theme!"),!0):!1};e.prototype.bind=e.prototype.on=e.prototype.addListener=function(a,d,c){this.checkIsInterfaceDeprecated(a)&&f[a]&&(a=f[a]);"undefined"==typeof b._plugins[a]&&(b._plugins[a]={});b._plugins[a][d]=c;return b};e.prototype.unbind=e.prototype.removeListener=function(a,d){d||(d="");this.checkIsInterfaceDeprecated(a)&&
"system"===d&&(d="system-default",f[a]&&(a=f[a]));""===d?b._plugins[a]={}:b._plugins[a]&&(b._plugins[a][d]=null,delete b._plugins[a][d]);return b};e.prototype.emit=function(a){var d=b.utils.getFromIndex(1,arguments),c;for(c in b._plugins[a])setTimeout(function(c){return function(){b._plugins[a][c].apply(b,d)}}(c),0);return b};e.prototype.listenerCount=function(a){return Object.keys(b._plugins[a])};b.plugin=new e;e=function(){};e.prototype.get=function(a){return(a=document.cookie.match(new RegExp("(^| )"+
a+"=([^;]*)(;|$)")))?unescape(a[2]):null};e.prototype.set=function(a,d,c){var e=new Date;c&&e.setTime(e.getTime()+parseInt(864E5*c));document.cookie=a+"="+escape(d)+"; "+(c?"expires="+e.toGMTString()+"; ":"")+"path="+b.options.cookiepath;return b};b.cookie=new e;e=function(){};e.prototype.output=function(){b.plugin.emit("userinfo.output");return b};e.prototype.save=function(){b.plugin.emit("userinfo.save");return b};e.prototype.saveFromHtml=e.prototype.readFromHtml=function(){b.plugin.emit("userinfo.readFromHtml");
return b};b.userinfo=new e;e=function(){};e.prototype.get=function(a,d){b.plugin.emit("comment.get",a,d)};e.prototype.reply=function(a){b.plugin.emit("comment.reply.start",a)};e.prototype.post=function(a){a=a||{};try{b.plugin.emit("comment.post.start",a)}catch(d){console.error(d)}return!1};b.comment=new e};"function"===typeof define&&define.amd?define("zbp",[],function(){return g}):"function"===typeof define&&define.cmd?define("zbp",[],function(b,e,a){a.exports=g}):"undefined"!==typeof module?module.exports=
g:window.ZBP=g})();